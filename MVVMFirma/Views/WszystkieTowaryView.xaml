<local:WszystkieViewBase x:Class="MVVMFirma.Views.WszystkieTowaryView"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                         xmlns:local="clr-namespace:MVVMFirma.Views"
                         xmlns:helper="clr-namespace:MVVMFirma.Helper"
                         mc:Ignorable="d"
                         d:DesignHeight="450"
                         d:DesignWidth="800">

    <local:WszystkieViewBase.Resources>
        <helper:VatIdToValueConverter x:Key="VatIdToValueConverter"/>
        <CollectionViewSource x:Key="TowaryViewSource"
                              Source="{Binding List}" />
    </local:WszystkieViewBase.Resources>

    <local:WszystkieViewBase.Template>
        <ControlTemplate TargetType="{x:Type local:WszystkieViewBase}">
            <Grid Margin="0,10,0,0">
                <ContentPresenter Margin="0,5,0,5"/>
            </Grid>
        </ControlTemplate>
    </local:WszystkieViewBase.Template>

    <Grid Background="White"
          Margin="4">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER / AKCJE -->
        <Border Grid.Row="0"
                Background="{StaticResource KassPrimaryDarkBrush}"
                CornerRadius="6"
                Margin="2,2,2,6">
            <Grid Margin="12,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Karta towaru"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{StaticResource KassLightTextBrush}" />
                    <TextBlock Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.Nazwa, TargetNullValue=Brak towaru}"
                               Foreground="{StaticResource KassLightTextBrush}"
                               Margin="0,4,0,0"
                               FontWeight="SemiBold" />
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <Button Content="Dodaj"
                            Command="{Binding AddCommand}"
                            Padding="10,4"
                            Margin="0,0,6,0"
                            Background="{StaticResource KassAccentBrush}"
                            Foreground="{StaticResource KassLightTextBrush}"
                            BorderBrush="{StaticResource KassPrimaryDarkBrush}"/>
                    <Button Content="Odśwież"
                            Command="{Binding RefreshCommand}"
                            Padding="10,4"
                            Margin="0,0,6,0"
                            Background="{StaticResource KassAccentBrush}"
                            Foreground="{StaticResource KassLightTextBrush}"
                            BorderBrush="{StaticResource KassPrimaryDarkBrush}"/>
                    <Button Content="Usuń"
                            Command="{Binding DeleteByCodeCommand}"
                            Padding="10,4"
                            Background="{StaticResource KassAccentBrush}"
                            Foreground="{StaticResource KassLightTextBrush}"
                            BorderBrush="{StaticResource KassPrimaryDarkBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- FILTRY + KOD DO USUNIĘCIA -->
        <Grid Grid.Row="1"
              Margin="2,0,2,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <WrapPanel Grid.Column="0"
                       VerticalAlignment="Center">
                <TextBlock Text="Szukaj:"
                           VerticalAlignment="Center"
                           Margin="0,0,6,0"/>
                <TextBox Width="200"
                         Margin="0,0,12,0"
                         Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBlock Text="Sortuj wg:"
                           VerticalAlignment="Center"
                           Margin="0,0,6,0"/>
                <ComboBox Width="180"
                          Margin="0,0,12,0"
                          ItemsSource="{Binding SortOptions}"
                          SelectedItem="{Binding SelectedSortField}"/>
                <CheckBox Content="Malejąco"
                          VerticalAlignment="Center"
                          Margin="0,0,12,0"
                          IsChecked="{Binding SortDescending}"/>
                <Button Content="Zastosuj"
                        Command="{Binding ApplyFilterCommand}"
                        Padding="8,4"
                        Margin="0,0,6,0"
                        Background="{StaticResource KassAccentBrush}"
                        Foreground="{StaticResource KassLightTextBrush}"
                        BorderBrush="{StaticResource KassPrimaryDarkBrush}"/>
                <Button Content="Wyczyść"
                        Command="{Binding ClearFilterCommand}"
                        Padding="8,4"
                        Background="{StaticResource KassAccentBrush}"
                        Foreground="{StaticResource KassLightTextBrush}"
                        BorderBrush="{StaticResource KassPrimaryDarkBrush}"/>
            </WrapPanel>

            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <TextBlock Text="Kod do usunięcia:"
                           VerticalAlignment="Center"
                           Margin="0,0,6,0"/>
                <TextBox Width="140"
                         Margin="0,0,6,0"
                         Text="{Binding DeleteCode, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>
        </Grid>

        <!-- DETALE ZAZNACZONEGO TOWARU -->
        <Grid Grid.Row="2"
              Margin="2,0,2,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <GroupBox Header="Dane podstawowe"
                      Margin="0,0,6,0">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.Kod, StringFormat=Kod: {0}, TargetNullValue=Kod: -}"
                               FontWeight="SemiBold" />
                    <TextBlock Grid.Row="1"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.Nazwa, StringFormat=Nazwa: {0}, TargetNullValue=Nazwa: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="2"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.KategoriaTowaru.Nazwa, StringFormat=Kategoria: {0}, TargetNullValue=Kategoria: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="3"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.JednostkaMiary.Nazwa, StringFormat=Jednostka miary: {0}, TargetNullValue=Jednostka miary: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="4"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.CzyAktywny, StringFormat=Aktywny: {0}, TargetNullValue=Aktywny: -}"
                               Margin="0,4,0,0" />
                </Grid>
            </GroupBox>

            <GroupBox Header="Ceny i VAT"
                      Grid.Column="1"
                      Margin="0,0,6,0">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.Cena, StringFormat=Cena sprzedaży: {0:0.00}, TargetNullValue=Cena sprzedaży: -}" />
                    <TextBlock Grid.Row="1"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.Marza, StringFormat=Marża: {0:0.##}, TargetNullValue=Marża: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="2"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.StawkaVat.Nazwa, StringFormat=VAT sprzedaży: {0}, TargetNullValue=VAT sprzedaży: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="3"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.StawkaVat1.Nazwa, StringFormat=VAT zakupu: {0}, TargetNullValue=VAT zakupu: -}"
                               Margin="0,4,0,0" />
                </Grid>
            </GroupBox>

            <GroupBox Header="Podsumowanie"
                      Grid.Column="2">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.StanMagazynowy.Count, StringFormat=Stany magazynowe: {0}, TargetNullValue=Stany magazynowe: -}"
                               FontWeight="SemiBold" />
                    <TextBlock Grid.Row="1"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaFakturySprzedazy.Count, StringFormat=Pozycje faktur: {0}, TargetNullValue=Pozycje faktur: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="2"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaZamowieniaSprzedazy.Count, StringFormat=Pozycje zamówień: {0}, TargetNullValue=Pozycje zamówień: -}"
                               Margin="0,4,0,0" />
                    <TextBlock Grid.Row="3"
                               Text="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaDokumentuMagazynowego.Count, StringFormat=Dokumenty magazynowe: {0}, TargetNullValue=Dokumenty magazynowe: -}"
                               Margin="0,4,0,0" />
                </Grid>
            </GroupBox>
        </Grid>

        <!-- LISTA TOWARÓW -->
        <DataGrid Grid.Row="3"
                  ItemsSource="{Binding Source={StaticResource TowaryViewSource}}"
                  IsSynchronizedWithCurrentItem="True"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  IsReadOnly="True"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  HeadersVisibility="Column"
                  Margin="2,0,2,8">

            <DataGrid.Columns>

                <DataGridTextColumn Header="ID"
                                    Width="60"
                                    Binding="{Binding IdTowaru}"/>

                <DataGridTextColumn Header="Kod"
                                    Width="100"
                                    Binding="{Binding Kod}"/>

                <DataGridTextColumn Header="Nazwa"
                                    Width="200"
                                    Binding="{Binding Nazwa}"/>

                <DataGridTextColumn Header="Cena"
                                    Width="100"
                                    Binding="{Binding Cena, StringFormat={}{0:0.00}}"/>

                <DataGridTextColumn Header="Marża"
                                    Width="80"
                                    Binding="{Binding Marza, StringFormat={}{0:0.##}}"/>

                <DataGridTextColumn Header="VAT sprz."
                                    Width="90"
                                    Binding="{Binding IdStawkiVatSprzedazy, Converter={StaticResource VatIdToValueConverter}}"/>

                <DataGridTextColumn Header="VAT zak."
                                    Width="90"
                                    Binding="{Binding IdStawkiVatZakupu, Converter={StaticResource VatIdToValueConverter}}"/>

                <DataGridCheckBoxColumn Header="Aktywny"
                                        Width="80"
                                        Binding="{Binding CzyAktywny}"/>

            </DataGrid.Columns>
        </DataGrid>

        <!-- ZAKŁADKI -->
        <TabControl Grid.Row="4"
                    Margin="2,0,2,0">
            <TabItem Header="Stany magazynowe">
                <DataGrid AutoGenerateColumns="False"
                          ItemsSource="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.StanMagazynowy}"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Margin="6">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Magazyn"
                                            Binding="{Binding Magazyn.Nazwa}" />
                        <DataGridTextColumn Header="Kod magazynu"
                                            Binding="{Binding Magazyn.Kod}" />
                        <DataGridTextColumn Header="Ilość"
                                            Binding="{Binding Ilosc}" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Pozycje faktur">
                <DataGrid AutoGenerateColumns="False"
                          ItemsSource="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaFakturySprzedazy}"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Margin="6">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Faktura"
                                            Binding="{Binding FakturaSprzedazy.Numer}" />
                        <DataGridTextColumn Header="Data"
                                            Binding="{Binding FakturaSprzedazy.DataWystawienia}" />
                        <DataGridTextColumn Header="Ilość"
                                            Binding="{Binding Ilosc}" />
                        <DataGridTextColumn Header="Cena netto"
                                            Binding="{Binding CenaNetto}" />
                        <DataGridTextColumn Header="Netto"
                                            Binding="{Binding WartoscNetto}" />
                        <DataGridTextColumn Header="Brutto"
                                            Binding="{Binding WartoscBrutto}" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Pozycje zamówień">
                <DataGrid AutoGenerateColumns="False"
                          ItemsSource="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaZamowieniaSprzedazy}"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Margin="6">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Zamówienie"
                                            Binding="{Binding ZamowienieSprzedazy.Numer}" />
                        <DataGridTextColumn Header="Data"
                                            Binding="{Binding ZamowienieSprzedazy.DataZamowienia}" />
                        <DataGridTextColumn Header="Status"
                                            Binding="{Binding ZamowienieSprzedazy.StatusZamowienia.Nazwa}" />
                        <DataGridTextColumn Header="Ilość"
                                            Binding="{Binding Ilosc}" />
                        <DataGridTextColumn Header="Cena netto"
                                            Binding="{Binding CenaNetto}" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Dokumenty magazynowe">
                <DataGrid AutoGenerateColumns="False"
                          ItemsSource="{Binding Source={StaticResource TowaryViewSource}, Path=CurrentItem.PozycjaDokumentuMagazynowego}"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Margin="6">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Dokument"
                                            Binding="{Binding DokumentMagazynowy.Numer}" />
                        <DataGridTextColumn Header="Typ"
                                            Binding="{Binding DokumentMagazynowy.TypDokumentuMagazynowego.Nazwa}" />
                        <DataGridTextColumn Header="Data"
                                            Binding="{Binding DokumentMagazynowy.DataDokumentu}" />
                        <DataGridTextColumn Header="Magazyn"
                                            Binding="{Binding DokumentMagazynowy.Magazyn.Nazwa}" />
                        <DataGridTextColumn Header="Ilość"
                                            Binding="{Binding Ilosc}" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>

    </Grid>
</local:WszystkieViewBase>
